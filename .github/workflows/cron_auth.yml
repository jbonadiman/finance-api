name: auth-refresh

on:
  schedule:
    - cron: '*/45 * * * *'

  workflow_dispatch:

jobs:
  cron:
    runs-on: ubuntu-latest

    steps:
      - name: Call the authentication endpoint to refresh the token
        run: |
          curl --request GET --get \
          --url "https://login.microsoftonline.com/consumers/oauth2/v2.0/authorize" \
           --data client_id="$MS_CLIENT_ID" \
           --data-urlencode redirect_uri="$MS_REDIRECT" \
           --data response_type="code" \
           --data scope="offline_access+tasks.readwrite" \
           --data state="12345"
        shell: bash
        env:
          MS_CLIENT_ID: ${{ secrets.MS_CLIENT_ID }}
          MS_REDIRECT: ${{ secrets.MS_REDIRECT }}
